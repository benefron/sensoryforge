pipeline:
  grid_size: 80
  spacing: 0.15
  center: [0.0, 0.0]
  filter_method: multi_step
  device: cpu
  seed: 42

innervation:
  sa:
    neurons_per_row: null  # Auto-determined from grid
    connections_per_neuron: 28
    sigma_d_mm: 0.3
    weight_range: [0.5, 1.5]
    edge_offset: null
  ra:
    neurons_per_row: null  # Auto-determined from grid  
    connections_per_neuron: 28
    sigma_d_mm: 0.3
    weight_range: [0.5, 1.5]
    edge_offset: null

neurons:
  sa_neurons: 100
  ra_neurons: 196
  dt: 0.1

noise:
  membrane_amplitude: 0.1
  receptor_amplitude: 0.1

stimulus:
  default_type: gaussian
  parameters:
    gaussian:
      sigma_x: 0.3
      sigma_y: 0.3
      magnitude: 1.0
    point:
      radius: 0.3
      magnitude: 1.0
    edge:
      edge_length: 1.0
      magnitude: 1.0

# -----------------------------------------------------------------------------
# Analysis & decoding sweep parameters (formerly config/pipeline_config.yml)
# -----------------------------------------------------------------------------

grid:
  size: 40
  spacing_mm: 0.15

populations:
  sa:
    neuron_counts: [81, 100, 196, 256, 400, 576, 784, 900, 1089, 1600, 2025]
    sigma_range: [0.05, 0.35]
    mean_inn_range: [20, 60]
    temporal_filter:
      method: multi_step
      dt_seconds: 0.0005
  ra:
    neuron_counts: [81, 100, 196, 256, 400, 576, 784, 900, 1089, 1600, 2025]
    sigma_range: [0.05, 0.35]
    mean_inn_range: [20, 60]
    temporal_filter:
      method: multi_step
      dt_seconds: 0.0005
  unfiltered:
    neuron_counts: [100, 196, 256, 400, 576, 784, 900, 1089, 1600, 2025]
    sigma_range: [0.075, 0.3]
    mean_inn_range: [20, 60]

ridge_lambda_grid: [0.0, 1.0e-4, 3.0e-4, 1.0e-3, 3.0e-3, 1.0e-2, 3.0e-2, 1.0e-1]

receptor_weight_range: [0.1, 1.0]

sampling:
  method: sobol
  coarse_samples_per_count: 32
  sobol_seed: 123

timing:
  dt_seconds: 0.0005

filters:
  sa:
    tau_r: 5.0
    tau_d: 30.0
    k1: 0.05
    k2: 3.0
    dt_ms: 0.5
  ra:
    tau_RA: 15.0
    k3: 2.0
    dt_ms: 0.5

stimuli:
  - id: gaussian_sigma_0_3_static
    type: gaussian
    center_x: 0.0
    center_y: 0.0
    sigma: 0.3
    amplitude: 1.0
    time_steps: 600
    temporal_profile:
      kind: ramp
      up_steps: 60
      down_steps: 60
  - id: gaussian_sigma_1_4_static
    type: gaussian
    center_x: -0.9
    center_y: 0.7
    sigma: 1.4
    amplitude: 1.0
    time_steps: 600
    temporal_profile:
      kind: ramp
      up_steps: 80
      down_steps: 80
  - id: edge_diagonal_sweep
    type: edge
    theta: 0.78539816339
    w: 0.3
    amplitude: 1.0
    time_steps: 600
    motion:
      kind: path
      coordinates:
        - [-4.0, -4.0]
        - [4.0, 4.0]
    temporal_profile:
      kind: ramp
      up_steps: 80
      down_steps: 80
  - id: edge_corner_sweep
    type: edge
    theta: -0.78539816339
    w: 0.3
    amplitude: 1.0
    time_steps: 800
    motion:
      kind: path
      coordinates:
        - [-0.0, 0.0]
        - [0.0, -0.0]
    temporal_profile:
      kind: ramp
      up_steps: 80
      down_steps: 80
  - id: edge_grating_sweep
    type: edge_grating
    theta: 1.57079632679
    spacing: 0.45
    count: 7
    w: 0.08
    amplitude: 1.0
    center_x: 0.0
    center_y: 0.0
    time_steps: 600
    motion:
      kind: horizontal
      span: 6.0
    temporal_profile:
      kind: ramp
      up_steps: 80
      down_steps: 80

fusion:
  default_mode: receptor
  receptor_weights: [0.5, 0.5]

metrics:
  data_range: 1.0
  weights:
    spatial:
      spatial_mse: 0.30
      spatial_ssim: 0.30
      spatial_r2: 0.20
      spatial_com_shift: 0.20
    temporal:
      temporal_mse: 0.30
      temporal_corr: 0.30
      temporal_ssim: 0.20
      spectral_entropy_delta: 0.20
    global:
      normalized_mutual_info: 1.0
    combined:
      spatial: 0.40
      temporal: 0.40
      global: 0.20

outputs:
  root_dir: analysis_results
  overwrite: false

# -----------------------------------------------------------------------------
# Bayesian Estimator Configuration
# -----------------------------------------------------------------------------
bayesian_estimator:
  dynamics:
    model: "random_walk" # or "ar1"
    rho: 0.95
  noise:
    process_cov_scale: 1.0e-4
    measurement_cov_scale: 0.1
  initialization:
    P0_scale: 1.0
  priors:
    spatial_sigma: 0.0

# -----------------------------------------------------------------------------
# Phase 2: Composite Grid Configuration (Multi-Population)
# -----------------------------------------------------------------------------
# Example composite grid with multiple receptor populations
# composite_grid:
#   type: composite  # 'standard' for single population
#   shape: [64, 64]
#   xlim: [-5.0, 5.0]
#   ylim: [-5.0, 5.0]
#   populations:
#     sa1:
#       density: 100.0      # receptors per mmÂ²
#       arrangement: grid   # grid, poisson, hex, jittered_grid
#       filter: SA          # Optional filter association
#     ra1:
#       density: 70.0
#       arrangement: hex
#       filter: RA
#     sa2:
#       density: 30.0
#       arrangement: poisson
#       filter: SA

# -----------------------------------------------------------------------------
# Phase 2: DSL Neuron Model Configuration
# -----------------------------------------------------------------------------
# Example equation-based neuron model definition
# dsl_neurons:
#   type: dsl
#   equations: |
#     dv/dt = (0.04*v**2 + 5*v + 140 - u + I) / ms
#     du/dt = (a * (b*v - u)) / ms
#   threshold: "v >= 30 * mV"
#   reset: |
#     v = c
#     u = u + d
#   parameters:
#     a: 0.02
#     b: 0.2
#     c: -65.0
#     d: 8.0
#   state_vars:
#     v: -65.0
#     u: -13.0

# -----------------------------------------------------------------------------
# Phase 2: Extended Stimuli Configuration
# -----------------------------------------------------------------------------
# Texture and moving stimuli examples
# extended_stimuli:
#   - type: texture
#     subtype: gabor
#     config:
#       wavelength: 0.5
#       orientation: 0.0   # radians
#       sigma: 0.3
#       amplitude: 1.0
#   - type: texture
#     subtype: edge_grating
#     config:
#       orientation: 0.0
#       spacing: 0.6
#       count: 5
#       edge_width: 0.05
#   - type: moving
#     motion_type: linear
#     config:
#       start: [0.0, 0.0]
#       end: [2.0, 0.0]
#       num_steps: 100
#       stimulus_type: gaussian  # Base stimulus to move
#       stimulus_params:
#         sigma: 0.3
#         amplitude: 1.0

# -----------------------------------------------------------------------------
# Phase 2: Solver Configuration
# -----------------------------------------------------------------------------
# ODE solver settings for neuron dynamics
solver_config:
  type: euler  # 'euler' (default) or 'adaptive'
  dt: 0.001    # Time step in seconds (for Euler)
  # Adaptive solver options (requires torchdiffeq or torchode)
  # adaptive:
  #   method: dopri5        # RK45, dopri5, etc.
  #   rtol: 1.0e-5         # Relative tolerance
  #   atol: 1.0e-7         # Absolute tolerance
  #   adjoint: false       # Use adjoint method for backprop

# -----------------------------------------------------------------------------
# Phase 2: GUI Defaults
# -----------------------------------------------------------------------------
gui_config:
  auto_load_config: true
  default_stimulus_type: gaussian
  enable_visualization: true
  visualization_type: heatmap  # 'heatmap' or 'raster'
  default_grid_type: standard  # 'standard' or 'composite'
  default_neuron_type: izhikevich  # 'izhikevich', 'adex', 'mqif', 'dsl'
  default_solver: euler  # 'euler' or 'adaptive'
